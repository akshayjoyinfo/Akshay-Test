@{
    ViewBag.Title = "Home Page";
}

<div class="col-md-12">
	<div class="row" style="margin-top: 10%">
	    <div class="col-md-6">
			<input type ="text" id="txtUser" name="txtUser" />
		</div>
		<div class="col-md-6">
			<input type="button" id="btnCreate" class="btn btn-success" value="Create SignalR Connection" />
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div id="messagesTable"></div>
		</div>
	</div>
</div>
@section Scripts{
    <script src="/Scripts/jquery.signalR-2.2.0.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>

    <script type="text/javascript">
        
        $(function() {
		
			$('#btnCreate').click(function() {
			    
			    var userId = $('#txtUser').val();
			    var notifications = $.connection.scopeHub;
			    
			    //debugger;
			    // Create a function that the hub can call to broadcast messages.
			    notifications.client.updateMessages = function (scopeObj) {
			       
			        var data = JSON.parse(scopeObj);
			        
			        $.notify('Sync Task for the Scope ' + data.Id + ' succesfully completed !!!!!!!!!!', 'success');
			            
			    };
			    // Start the connection.
			    $.connection.hub.start().done(function () {
			        console.log('Connection STARTED !!!');
			        notifications.server.registerMeAs(userId);

			        $.ajax({
			            url: '/home/GetScopes',
			            data: { uId: userId },
			            contentType: 'application/html ; charset:utf-8',
			            type: 'GET',
			            dataType: 'html'
			        }).success(function (result) {
			            var data = JSON.parse(result);
			            for (var i = 0; i < data.length; i++) {
			                if (data[i] != '') {
			                    $.notify('Sync Task for the Scope '+data[i].Id +' succesfully completed !!!!!!!!!!', 'success');
			                }
			            }

			        }).error(function () {
			            console.log("errerin GetScopes Method");
			        });
			        
			       

			    }).fail(function (e) {
			        alert(e);
			    });

			});
            // Declare a proxy to reference the hub.
           });

       
    </script>
}